{% extends "base.html" %}

{% block title %}Dashboard - Maqueta Web{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <h1><i class="bi bi-speedometer2"></i>Dashboard</h1>
        <p class="text-muted mb-0 mt-1">Panoramica generale del sistema</p>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-outline-primary" onclick="location.reload()">
            <i class="bi bi-arrow-clockwise"></i>
            <span class="d-none d-md-inline">Aggiorna</span>
        </button>
    </div>
</div>

<!-- Welcome Banner -->
<div class="card mb-4 slide-up" style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border: none;">
    <div class="card-body p-4">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h3 class="text-white mb-2">
                    Bentornato, {{ current_user.nome }}!
                </h3>
                <p class="text-white opacity-75 mb-0">
                    {% if current_user.ultimo_accesso %}
                    Ultimo accesso: {{ current_user.ultimo_accesso.strftime('%d %B %Y alle %H:%M') }}
                    {% else %}
                    Questo e il tuo primo accesso al sistema
                    {% endif %}
                </p>
            </div>
            <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <div class="d-inline-flex align-items-center bg-white bg-opacity-10 rounded-pill px-4 py-2">
                    <i class="bi bi-shield-check text-white me-2" style="font-size: 1.5rem;"></i>
                    <span class="text-white fw-semibold">
                        {% if current_user.is_admin %}Amministratore{% else %}Utente{% endif %}
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="row mb-4">
    <div class="col-md-6 col-lg-3 mb-4">
        <div class="card stat-card h-100 slide-up stagger-1">
            <div class="card-body text-center py-4">
                <div class="stat-icon primary mx-auto">
                    <i class="bi bi-person-badge"></i>
                </div>
                <h5 class="card-title mt-3">Il tuo profilo</h5>
                <p class="card-text">{{ current_user.nome_completo }}</p>
                <span class="badge bg-primary">{{ current_user.username }}</span>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4">
        <div class="card stat-card h-100 slide-up stagger-2">
            <div class="card-body text-center py-4">
                <div class="stat-icon success mx-auto">
                    <i class="bi bi-calendar-check"></i>
                </div>
                <h5 class="card-title mt-3">Data iscrizione</h5>
                <p class="card-text">{{ current_user.data_creazione.strftime('%d/%m/%Y') }}</p>
                <span class="badge bg-success">Attivo</span>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4">
        <div class="card stat-card h-100 slide-up stagger-3">
            <div class="card-body text-center py-4">
                <div class="stat-icon info mx-auto">
                    <i class="bi bi-clock-history"></i>
                </div>
                <h5 class="card-title mt-3">Ultimo accesso</h5>
                <p class="card-text">
                    {% if current_user.ultimo_accesso %}
                    {{ current_user.ultimo_accesso.strftime('%d/%m/%Y') }}
                    {% else %}
                    Prima volta
                    {% endif %}
                </p>
                <span class="badge bg-info">
                    {% if current_user.ultimo_accesso %}
                    {{ current_user.ultimo_accesso.strftime('%H:%M') }}
                    {% else %}
                    Nuovo
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <div class="col-md-6 col-lg-3 mb-4">
        <div class="card stat-card h-100 slide-up stagger-4">
            <div class="card-body text-center py-4">
                <div class="stat-icon warning mx-auto">
                    <i class="bi bi-envelope"></i>
                </div>
                <h5 class="card-title mt-3">Email</h5>
                <p class="card-text text-truncate" style="max-width: 180px; margin: 0 auto;">
                    {{ current_user.email or 'Non impostata' }}
                </p>
                <span class="badge bg-{{ 'warning' if not current_user.email else 'success' }}">
                    {{ 'Da configurare' if not current_user.email else 'Configurata' }}
                </span>
            </div>
        </div>
    </div>
</div>

{% if current_user.is_admin %}
<!-- Admin Section -->
<div class="row">
    <div class="col-12">
        <div class="card slide-up">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div>
                    <i class="bi bi-gear-wide-connected me-2"></i>
                    Pannello Amministratore
                </div>
                <span class="badge bg-warning">Admin</span>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    <!-- Gestione Utenti -->
                    <div class="col-md-4">
                        <a href="{{ url_for('lista_utenti') }}" class="tool-card d-block h-100">
                            <div class="d-flex flex-column align-items-center justify-content-center h-100 py-4">
                                <div class="stat-icon primary mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                    <i class="bi bi-people-fill"></i>
                                </div>
                                <h6 class="mb-1">Gestione Utenti</h6>
                                <small class="text-muted">Crea, modifica ed elimina utenti</small>
                            </div>
                        </a>
                    </div>

                    <!-- Placeholder per future funzionalita -->
                    <div class="col-md-4">
                        <div class="tool-card d-block h-100" style="opacity: 0.6; cursor: not-allowed;">
                            <div class="d-flex flex-column align-items-center justify-content-center h-100 py-4">
                                <div class="stat-icon success mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                    <i class="bi bi-menu-button-wide"></i>
                                </div>
                                <h6 class="mb-1">Gestione Menu</h6>
                                <small class="text-muted">Prossimamente</small>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="tool-card d-block h-100" style="opacity: 0.6; cursor: not-allowed;">
                            <div class="d-flex flex-column align-items-center justify-content-center h-100 py-4">
                                <div class="stat-icon info mb-3" style="width: 60px; height: 60px; font-size: 1.5rem;">
                                    <i class="bi bi-bar-chart-line"></i>
                                </div>
                                <h6 class="mb-1">Report & Statistiche</h6>
                                <small class="text-muted">Prossimamente</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card slide-up">
            <div class="card-header">
                <i class="bi bi-lightning-charge me-2"></i>
                Azioni Rapide
            </div>
            <div class="card-body">
                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ url_for('nuovo_utente') }}" class="btn btn-primary">
                        <i class="bi bi-person-plus me-1"></i>
                        Nuovo Utente
                    </a>
                    <a href="{{ url_for('lista_utenti') }}" class="btn btn-outline-primary">
                        <i class="bi bi-people me-1"></i>
                        Lista Utenti
                    </a>
                    <button class="btn btn-outline-secondary" disabled>
                        <i class="bi bi-file-earmark-pdf me-1"></i>
                        Esporta Report
                    </button>
                    <button class="btn btn-outline-secondary" disabled>
                        <i class="bi bi-gear me-1"></i>
                        Impostazioni
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- User Section -->
<div class="row">
    <div class="col-12">
        <div class="card slide-up">
            <div class="card-header">
                <i class="bi bi-lightning-charge me-2"></i>
                Accesso Rapido
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    {% for item in menu_items %}
                    <div class="col-md-4">
                        <a href="{{ item.url }}" class="tool-card d-block h-100">
                            <div class="d-flex flex-column align-items-center justify-content-center h-100 py-4">
                                <i class="{{ item.icona }}" style="font-size: 2.5rem; color: var(--primary);"></i>
                                <h6 class="mt-3 mb-0">{{ item.nome }}</h6>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Activity Timeline (placeholder) -->
<div class="row mt-4">
    <div class="col-lg-8">
        <div class="card slide-up">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div>
                    <i class="bi bi-activity me-2"></i>
                    Attivita Recenti
                </div>
                <span class="badge bg-secondary">In arrivo</span>
            </div>
            <div class="card-body">
                <div class="empty-state py-4">
                    <i class="bi bi-clock-history"></i>
                    <h5>Nessuna attivita recente</h5>
                    <p class="text-muted mb-0">Le tue attivita recenti appariranno qui</p>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4 mt-4 mt-lg-0">
        <div class="card slide-up">
            <div class="card-header">
                <i class="bi bi-info-circle me-2"></i>
                Info Sistema
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between py-2 border-bottom">
                    <span class="text-muted">Versione</span>
                    <span class="fw-semibold">1.0.0</span>
                </div>
                <div class="d-flex justify-content-between py-2 border-bottom">
                    <span class="text-muted">Framework</span>
                    <span class="fw-semibold">Flask</span>
                </div>
                <div class="d-flex justify-content-between py-2 border-bottom">
                    <span class="text-muted">Database</span>
                    <span class="fw-semibold">MySQL</span>
                </div>
                <div class="d-flex justify-content-between py-2">
                    <span class="text-muted">Stato</span>
                    <span class="badge bg-success">Online</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Animate numbers (placeholder for future stats)
    function animateValue(element, start, end, duration) {
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            element.textContent = Math.floor(progress * (end - start) + start);
            if (progress < 1) {
                window.requestAnimationFrame(step);
            }
        };
        window.requestAnimationFrame(step);
    }

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
{% endblock %}
