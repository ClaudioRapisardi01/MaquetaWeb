{% extends "base.html" %}

{% block title %}Cambia Password - Maqueta Web{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}" class="text-decoration-none">Dashboard</a></li>
                <li class="breadcrumb-item active">Cambia Password</li>
            </ol>
        </nav>
        <h1>
            <i class="bi bi-key"></i>
            Cambia Password
        </h1>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
        <div class="card slide-up">
            <div class="card-header">
                <i class="bi bi-shield-lock me-2"></i>
                Modifica la tua password
            </div>
            <div class="card-body">
                <form method="POST" id="passwordForm">
                    <div class="mb-4">
                        <label class="form-label">Password Attuale <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-lock"></i></span>
                            <input type="password" class="form-control" name="password_attuale" id="password_attuale" required>
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('password_attuale')">
                                <i class="bi bi-eye" id="toggle_password_attuale"></i>
                            </button>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="mb-3">
                        <label class="form-label">Nuova Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-key"></i></span>
                            <input type="password" class="form-control" name="nuova_password" id="nuova_password" required minlength="6">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('nuova_password')">
                                <i class="bi bi-eye" id="toggle_nuova_password"></i>
                            </button>
                        </div>
                        <small class="text-muted">Minimo 6 caratteri</small>
                    </div>

                    <div class="mb-4">
                        <label class="form-label">Conferma Nuova Password <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-key-fill"></i></span>
                            <input type="password" class="form-control" name="conferma_password" id="conferma_password" required minlength="6">
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('conferma_password')">
                                <i class="bi bi-eye" id="toggle_conferma_password"></i>
                            </button>
                        </div>
                        <div id="passwordMatch" class="form-text"></div>
                    </div>

                    <div class="d-flex gap-3">
                        <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                            <i class="bi bi-check-lg me-1"></i>
                            Cambia Password
                        </button>
                        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary btn-lg">
                            <i class="bi bi-x-lg me-1"></i>
                            Annulla
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Info Card -->
        <div class="card mt-4 slide-up stagger-1">
            <div class="card-header">
                <i class="bi bi-info-circle me-2"></i>
                Consigli per una password sicura
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li class="d-flex mb-2">
                        <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                        <span>Usa almeno 8 caratteri</span>
                    </li>
                    <li class="d-flex mb-2">
                        <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                        <span>Combina lettere maiuscole e minuscole</span>
                    </li>
                    <li class="d-flex mb-2">
                        <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                        <span>Includi numeri e simboli speciali</span>
                    </li>
                    <li class="d-flex">
                        <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                        <span>Evita informazioni personali facilmente indovinabili</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function togglePassword(fieldId) {
        const field = document.getElementById(fieldId);
        const icon = document.getElementById('toggle_' + fieldId);

        if (field.type === 'password') {
            field.type = 'text';
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
        } else {
            field.type = 'password';
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
        }
    }

    // Verifica corrispondenza password
    const nuovaPassword = document.getElementById('nuova_password');
    const confermaPassword = document.getElementById('conferma_password');
    const passwordMatch = document.getElementById('passwordMatch');
    const submitBtn = document.getElementById('submitBtn');

    function checkPasswordMatch() {
        if (confermaPassword.value === '') {
            passwordMatch.textContent = '';
            passwordMatch.className = 'form-text';
            return;
        }

        if (nuovaPassword.value === confermaPassword.value) {
            passwordMatch.textContent = 'Le password coincidono';
            passwordMatch.className = 'form-text text-success';
            confermaPassword.classList.remove('is-invalid');
            confermaPassword.classList.add('is-valid');
        } else {
            passwordMatch.textContent = 'Le password non coincidono';
            passwordMatch.className = 'form-text text-danger';
            confermaPassword.classList.remove('is-valid');
            confermaPassword.classList.add('is-invalid');
        }
    }

    nuovaPassword.addEventListener('input', checkPasswordMatch);
    confermaPassword.addEventListener('input', checkPasswordMatch);

    // Form validation
    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        if (nuovaPassword.value !== confermaPassword.value) {
            e.preventDefault();
            alert('Le password non coincidono!');
            return;
        }

        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Salvataggio...';
        submitBtn.disabled = true;
    });
</script>
{% endblock %}
